<!--
  SONAR User Interface
  Copyright (C) 2024 RERO

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, version 3 of the License.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->

<ngx-spinner
  name="file-upload"
  color="#fff"
  size="medium"
  type="ball-zig-zag"
  [fullScreen]="true"
>
  <p class="text-white">
    {{ 'Loading...' | translate }}
    @if (fileUpload?.files?.length > 0) {
      ({{ nUploadedFiles }} / {{ fileUpload.files.length }})
    }
  </p>
</ngx-spinner>

@if (files != null) {
  <div class="row mt-4">
    <div class="col-12">
      <h5 class="mb-2" translate>Upload Files</h5>
      <p-fileUpload
        [disabled]="reachMaxFileLimit"
        #fileUpload
        [auto]="true"
        [multiple]="true"
        name="uploadFiles"
        [chooseLabel]="'Add file' | translate"
        [customUpload]="true"
        (uploadHandler)="uploadHandler($event, '')"
        mode="advanced"
        [maxFileSize]="maxFileSize"
        (onSelect)="onSelect($event, '')"
      >
        <ng-template pTemplate="toolbar">
          <div></div>
          <div class="mt-2">
            <small translate>
              By uploading a file, I declare that I am aware of the terms and
              conditions of the copyright transfer agreement governing the
              publication of the respective document, and that the deposit of its
              full-text content in the current platform is compatible with those.
            </small>
          </div>
        </ng-template>

        <ng-template let-file pTemplate="file"> </ng-template>

        <ng-template let-file pTemplate="content">
          @if (reachMaxFileLimit) {
            <div class="alert alert-danger" role="alert" translate>
              The maximum number of files is reached. No additional upload is
              allowed.
            </div>
          } @else {
            <span translate>Drag and drop files.</span>
          }
        </ng-template>
      </p-fileUpload>
    </div>

    <p-orderList
      #orderList
      [value]="files"
      (onReorder)="reorder()"
      [header]="'Uploaded Files' | translate"
      [filterBy]="files.length > 5 ? 'label' : null"
      [dragdrop]="false"
      controlsPosition="right"
      class="w-100 col-12"
      metaKeySelection="true"
      [filterPlaceholder]="'Filter by label' | translate"
    >
      <ng-template let-file pTemplate="item">
        <sonar-file-item
          [schema]="fileSchema()"
          (update)="update(file, $event)"
          (delete)="deleteFile($event)"
          [file]="file"
          (upload)="uploadNewVersion($event)"
        ></sonar-file-item>
      </ng-template>
    </p-orderList>
  </div>
} @else {
  <i class="fa fa-spinner fa-spin"></i>
}
