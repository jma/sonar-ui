<!--
  SONAR User Interface
  Copyright (C) 2021 RERO

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, version 3 of the License.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->

<form [formGroup]="form">
  <div class="flex justify-content-end flex-wrap">
    <div class="flex align-items-center justify-content-center">
      @if(currentStep() === 'metadata') {
      <p-splitButton
        [label]="'Import metadata' | translate"
        [model]="importMenuItems"
      />
      } @if(currentStep() === 'diffusion') {
      <p-button
        class="m-2"
        (click)="save()"
        [label]="'Save' | translate"
        iconPos="right"
      />
      } @else {
      <p-button
        class="m-2"
        (click)="save()"
        icon="pi pi-chevron-right"
        [label]="'Continue' | translate"
        iconPos="right"
      />
      } @if(canSubmit()) {
      <p-button
        class="m-2"
        (click)="confirmPublish()"
        [label]="isAdminUser ? ('Publish' | translate) : ('Submit' | translate)"
        iconPos="right"
      />
      }
    </div>
  </div>

  <!-- metadata editor -->
  <formly-form
    [form]="form"
    [model]="model"
    [fields]="fields"
    [class]="'step-' + currentStep"
  />
</form>

<p-dialog
  [header]="'Import from swisscovery' | translate"
  [modal]="true"
  [(visible)]="importModalIsVisible"
  styleClass="w-25rem"
>
<sonar-deposit-editor-swisscovery (data)="mapSwisscoverRecord($event)"/>
</p-dialog>
